<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>statser</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.40/css/uikit.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.40/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.40/js/uikit-icons.min.js"></script>
    <script src="elm.js"></script>
    <style>
    .line {
      fill: none;
      stroke: #007bff;
      stroke-width: 3px;
    }
    .legend {
      font-size: 80%;
    }
    table#metrics {
      cursor: pointer;
    }
    </style>
  </head>
  <body>
    <script>
    var width = 560 - 2 * 50;
    var height = 240 - 2 * 50;
    var duration = 750;

    var x = d3.scaleTime().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    var valueline = d3.line()
      .curve(d3.curveCatmullRom)
      .x(function(d) { return x(new Date(d[0] * 1000)); })
      .y(function(d) { return y(d[1]); });

    var app = Elm.Main.fullscreen();

    app.ports.liveUpdate.subscribe(function(data) {
        var metric = data[0];
        var stats = data[1];

        var svg = d3.select('#live').transition();

        x.domain(d3.extent(stats, function(d) { return new Date(d[0] * 1000); }));
        y.domain(d3.extent(stats, function(d) { return d[1]; }));

        svg.select('.line')
          .duration(duration)
          .attr('d', valueline(stats));

        svg.select('.legend')
          .text(metric);

        svg.select('.xaxis')
          .duration(duration)
          .call(d3.axisBottom(x));

        svg.select('.yaxis')
          .duration(duration)
          .call(d3.axisLeft(y).ticks(6));
    });
    </script>
  </body>
</html>
